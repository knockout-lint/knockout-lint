# How it works

KOLint is separated into four parts.

- [The program](#program) <!-- omit in TOC -->
- [The parsers](#parser) <!-- omit in TOC -->
- [The compiler](#compiler) <!-- omit in TOC -->
- [The CLI](#cli) <!-- omit in TOC -->

## Program

The program keeps track of diagnostics, rules, and if or what rules is disabled. The program is also a portal to the parser and compiler.

## Parser

It's purpose of the parser is pretty obvious. The parser is built with [jison](https://github.com/zaach/jison) and [meriyah](https://npmjs.com/meriyah/meriyah). The parser is separated into two parts, being [parsing the view](#view-parser) (HTML) and [parsing the](#binding-parser) [_knockout_](https://github.com/v/knockout) [bindings](#binding-parser) in the view.

### View Parser

The view parser is built with [jison](https://github.com/zaach/jison). The view parser is a custom parser. This gives us performance and the luxery to not parse the bindings or the viewmodel and bindinghandler imports, instead we can parse them directly with the [grammar file](https://github.com/kolint/kolint/blob/master/src/parser/grammar.jison) using [jison](https://github.com/zaach/jison).

### Binding Parser

The binding parser is not custom, instead we used [meriyah](https://github.com/meriyah/meriyah). It uses the same tree as acorn, is faster, has ES2020 support and has few issues known. The bindings can not be parsed directly of course, so we wrapped the binding inside the brrackets which makes the binding a object.

## Compiler

The compiler generates an emit using [typescript](https://github.com/microsoft/typescript) that can later on be type checked. The compiler is separated into two parts, being [generating the emit](#generated-emit) and [generating the source map](#source-map) along the way.

### Generated Emit

The generated code/emit is generating using [typescript](https://github.com/microsoft/typescript). The emit consists of three parts, being the [typescript](https://github.com/microsoft/typescript) compiler, the actual code emit, and the type injection.

The generated code is built of a **scaffold** located at `lib/resources/scaffold.ts`. The scaffold is essentially being more and more replaced by the generated code.

The **context declaration** file located at `lib/resources/context.d.ts` and is import by the generated code. It essentially contains all of the typings and interfaces needed by the generated code.

The **type injection** is the type injection which occurs after the code has been generated, during the code compilation. It replaces all placeholders with code generated by [typescript](https://github.com/microsoft/typescript).

### Source Map

The source maps are built using a internal function from [typescript](https://github.com/microsoft/typescript). The are built while [emitting the output](#generated-emit).

## CLI

The Command Line Interface is a CLI wrapper included with the `knockout-lint` package.
